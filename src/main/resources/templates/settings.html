<!DOCTYPE html>
<html lang="en">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
<link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}" rel="stylesheet" />
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
</head>
<body class="bg-light vh-100 d-flex">
    <div class="container" style="max-width: 960px;">
        <div class="mx-auto w-100 mt-5 py-3">
            <div class="text-center mb-3">
                <img th:src="${user.userPicture != null} ? @{|/avatars/${user.userPicture}|} : @{/avatars/anonymous.png}" alt="mdo" width="100" height="100" class="rounded-circle mb-1">
                <p class="fw-bold" th:text="${user.username}"></p>
            </div>
            <h2 class="mb-3 fw-bold" style="display: inline-block;">Settings</h2>
            <a th:href="@{/tasks}" style="margin-left: 10px;" class="mb-3">Back to tasks</a>
            <div class="d-flex">
                <div class="card w-100 p-3 bg-white me-2">
                    <div class="card-body">
                        <h3 class="card-title mb-3">Change image</h3>
                        <form style="height: 296px;" class="position-relative" method="post" th:action="@{/settings/changeImage}" enctype="multipart/form-data">
                            <div class="mb-3">
                                <input class="form-control" type="file" name="file" accept="image/*">
                            </div>
                            <div th:if="${errorMessage != null}" class="alert alert-danger" role="alert">
                                <p th:text="${errorMessage}"></p>
                            </div>
                            <button type="submit" class="btn btn-primary mt-auto position-absolute bottom-0">Save</button>
                            <button th:if="${user.userPicture != null}" type="submit" class="btn btn-danger mt-auto position-absolute bottom-0 end-0" th:attr="formaction=@{/settings/deleteImage}">Delete Image</button>
                        </form>

                    </div>
                </div>
                <div class="card w-100 p-3 bg-white ms-2">
                    <div class="card-body">
                        <h3 class="card-title mb-3">Change password</h3>
                        <form th:action="@{/settings/changePassword}" th:object="${form}" method="post">
                            <div th:if="${#fields.hasErrors('currentPassword')}" class="alert alert-danger" role="alert">
                                <p th:text="${#fields.errors('currentPassword')[0]}"></p>
                            </div>
                            <div class="mb-3">
                                <label for="current-password" class="form-label">Current password</label>
                                <input class="form-control" id="current-password" type="password" name="currentPassword">
                            </div>
                            <div th:if="${#fields.hasErrors('newPassword')}" class="alert alert-danger" role="alert">
                                <p th:text="${#fields.errors('newPassword')[0]}"></p>
                            </div>
                            <div class="mb-3">
                                <label for="new-password" class="form-label">New password</label>
                                <input class="form-control" id="new-password" type="password" name="newPassword">
                            </div>
                            <div th:if="${#fields.hasErrors('repeatPassword')}" class="alert alert-danger" role="alert">
                                <p th:text="${#fields.errors('repeatPassword')[0]}"></p>
                            </div>
                            <div class="mb-3">
                                <label for="repeat-password" class="form-label">Confirm password</label>
                                <input class="form-control" id="repeat-password" type="password" name="repeatPassword">
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="card mt-3">
                <div class="card-body">
                    <h3 class="card-title mb-3">Deleting account</h3>
                    <p class="card-text">Deleting your account will remove all of your data from database. This cannot be undone.</p>
                    <form>
                        <button type="submit" class="btn btn-danger">Delete account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</html>